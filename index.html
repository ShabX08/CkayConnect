<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Quick Connect</title><script src="https://cdn.tailwindcss.com"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css"><style>body{font-family:'Poppins',sans-serif;font-size:14px}.hidden{display:none}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideIn{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.animate-fadeIn{animation:fadeIn 0.5s ease-out}.animate-slideIn{animation:slideIn 0.5s ease-out}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-base{font-size:1rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.nav-icon{font-size:1.25rem;transition:all 0.3s ease}.nav-link:hover.nav-icon{transform:scale(1.2)}.nav-link{position:relative;overflow:hidden}.nav-link::after{content:'';position:absolute;bottom:0;left:0;width:100%;height:2px;background-color:#3B82F6;transform:scaleX(0);transition:transform 0.3s ease}.nav-link:hover::after{transform:scaleX(1)}</style></head><body class="bg-gray-100 p-3"><!-- Navbar --><nav class="bg-white shadow-md mb-4 animate-fadeIn"><div class="max-w-6xl mx-auto px-3 sm:px-4 lg:px-6"><div class="flex justify-between items-center h-16"><div class="flex-shrink-0 flex items-center"><a href="#" class="text-lg font-bold text-blue-600">Quick Connect</a></div><div class="hidden md:flex md:items-center md:justify-end md:flex-1"><div class="flex space-x-4"><a href="#" class="nav-link text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-300" id="nav-home">Home</a><a href="#" class="nav-link text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-300" id="nav-data">Data</a><a href="#" class="nav-link text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-300" id="nav-orders">Orders</a><a href="#" class="nav-link text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-300" id="nav-account">Account</a><a href="#" class="nav-link text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-300" id="nav-login">Login</a><a href="#" class="nav-link text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-300" id="nav-signup">Sign Up</a><a href="#" class="nav-link text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-300 hidden" id="nav-logout">Logout</a></div></div><div class="flex items-center md:hidden"><button id="menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-300" aria-expanded="false"><span class="sr-only">Open main menu</span><i class="fas fa-bars"></i></button></div></div></div><div id="mobile-menu" class="md:hidden hidden"><div class="px-2 pt-2 pb-3 space-y-1"><a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition duration-300" id="nav-mobile-home">Home</a><a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition duration-300" id="nav-mobile-data">Data</a><a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition duration-300" id="nav-mobile-orders">Orders</a><a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition duration-300" id="nav-mobile-account">Account</a><a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition duration-300" id="nav-mobile-login">Login</a><a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition duration-300" id="nav-mobile-signup">Sign Up</a><a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition duration-300 hidden" id="nav-mobile-logout">Logout</a></div></div></nav><!-- Main Content --><div id="main-content" class="max-w-xl mx-auto bg-white p-4 shadow-md rounded-lg animate-fadeIn"><!-- Home Page --><div id="home-page" class="hidden"><h1 class="text-2xl font-bold mb-3">QUICK CONNECT</h1><p class="mb-3 text-sm">Choose from our wide range of data plans and stay connected!</p><div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4"><div class="bg-green-100 p-3 rounded-lg animate-slideIn" style="animation-delay: 0.1s;"><h2 class="text-lg font-semibold mb-2"><i class="fas fa-sliders-h text-green-500 mr-2"></i>Flexible Options</h2><p class="text-sm">Choose from a variety of data plans to suit your needs and budget.</p></div><div class="bg-yellow-100 p-3 rounded-lg animate-slideIn" style="animation-delay: 0.2s;"><h2 class="text-lg font-semibold mb-2"><i class="fas fa-magic text-yellow-500 mr-2"></i>Super-Fast Activation</h2><p class="text-sm">Get your data plan activated very early after purchase.</p></div><div class="bg-purple-100 p-3 rounded-lg animate-slideIn" style="animation-delay: 0.3s;"><h2 class="text-lg font-semibold mb-2"><i class="fas fa-headset text-purple-500 mr-2"></i>24/7 Support</h2><p class="text-sm">Our customer support team is always ready to assist you.</p></div></div><button class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition duration-300 text-sm" id="go-to-data"><i class="fas fa-chevron-right mr-2"></i>VIEW PLANS</button></div><!-- Data Purchase Page --><div id="data-page" class="hidden"><h2 class="text-2xl font-bold mb-3">MTN OFFERS</h2><p class="text-xl font-semibold text-gray-800 mb-2"><span id="price">₵5.50</span>– ₵24.00<span class="text-xs font-normal"></span></p><div class="mb-3"><h3 class="text-base font-semibold mb-2">Quantity</h3><div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2" id="size-options"><button class="border border-gray-300 py-1 px-2 text-xs hover:bg-blue-100 transition duration-300" data-size="1000" data-price="₵5.50">1GB</button><button class="border border-gray-300 py-1 px-2 text-xs hover:bg-blue-100 transition duration-300" data-size="2000" data-price="₵10.50">2GB</button><button class="border border-gray-300 py-1 px-2 text-xs hover:bg-blue-100 transition duration-300" data-size="3000" data-price="₵14.50">3GB</button><button class="border border-gray-300 py-1 px-2 text-xs hover:bg-blue-100 transition duration-300" data-size="4000" data-price="₵20.50">4GB</button><button class="border border-gray-300 py-1 px-2 text-xs hover:bg-blue-100 transition duration-300" data-size="5000" data-price="₵24.00">10GB</button></div></div><div class="mb-3"><h3 class="text-base font-semibold mb-2">TAKE NOTE</h3><p class="text-red-600 text-center mb-2 text-xs" style="text-align: left;">Delivery time is between 20min to 4hrs</p></div><div class="mb-3"><label for="phone-number" class="block text-sm font-semibold mb-2">Beneficiary Phone Number<span class="text-red-600">*</span></label><input type="text" id="phone-number" class="w-full border border-gray-300 p-2 rounded text-sm" placeholder="enter number here"></div><button class="w-full bg-blue-500 text-white py-2 font-semibold rounded hover:bg-blue-600 transition duration-300 text-sm" id="buy-button"><i class="fas fa-chevron-right mr-2"></i>ACTIVATE DATA</button><div class="mt-3 text-xs text-gray-600"><p><i class="fas fa-tag mr-1"></i>Category:MTN DATA</p></div></div><!-- Login Page --><div id="login-page" class="hidden"><h2 class="text-xl font-bold mb-3"><i class="fas fa-sign-in-alt mr-2"></i>Login</h2><form id="login-form"><div class="mb-3"><label for="login-email" class="block text-sm font-semibold mb-2">Email</label><input type="email" id="login-email" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><div class="mb-3"><label for="login-password" class="block text-sm font-semibold mb-2">Password</label><input type="password" id="login-password" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><button type="submit" class="w-full bg-blue-500 text-white py-2 font-semibold rounded hover:bg-blue-600 transition duration-300 text-sm"><i class="fas fa-sign-in-alt mr-2"></i>Login</button></form><div class="mt-3 text-center"><a href="#" id="forgot-password-link" class="text-blue-500 hover:underline text-sm"><i class="fas fa-key mr-1"></i>Forgot Password?</a></div></div><!-- Signup Page --><div id="signup-page" class="hidden"><h2 class="text-xl font-bold mb-3"><i class="fas fa-user-plus mr-2"></i>Sign Up</h2><form id="signup-form"><div class="mb-3"><label for="signup-username" class="block text-sm font-semibold mb-2">Username</label><input type="text" id="signup-username" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><div class="mb-3"><label for="signup-phone" class="block text-sm font-semibold mb-2">Phone Number</label><input type="tel" id="signup-phone" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><div class="mb-3"><label for="signup-email" class="block text-sm font-semibold mb-2">Email</label><input type="email" id="signup-email" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><div class="mb-3"><label for="signup-password" class="block text-sm font-semibold mb-2">Password</label><input type="password" id="signup-password" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><div class="mb-3"><label for="signup-confirm-password" class="block text-sm font-semibold mb-2">Confirm Password</label><input type="password" id="signup-confirm-password" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><button type="submit" class="w-full bg-blue-500 text-white py-2 font-semibold rounded hover:bg-blue-600 transition duration-300 text-sm"><i class="fas fa-user-plus mr-2"></i>Sign Up</button></form></div><!-- Orders Page --><div id="orders-page" class="hidden"><h2 class="text-xl font-bold mb-3"><i class="fas fa-list-alt mr-2"></i>Recent Orders</h2><div id="orders-list" class="space-y-3 max-h-80 overflow-y-auto pr-2"></div></div><!-- Forgot Password Page --><div id="forgot-password-page" class="hidden"><h2 class="text-xl font-bold mb-3"><i class="fas fa-key mr-2"></i>Forgot Password</h2><form id="forgot-password-form"><div class="mb-3"><label for="forgot-password-email" class="block text-sm font-semibold mb-2">Email</label><input type="email" id="forgot-password-email" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><button type="submit" class="w-full bg-blue-500 text-white py-2 font-semibold rounded hover:bg-blue-600 transition duration-300 text-sm"><i class="fas fa-paper-plane mr-2"></i>Reset Password</button></form></div><!-- Account Page --><div id="account-page" class="hidden"><h2 class="text-xl font-bold mb-3"><i class="fas fa-user-circle mr-2"></i>Account Details</h2><form id="account-form"><div class="mb-3"><label for="account-username" class="block text-sm font-semibold mb-2">Username</label><input type="text" id="account-username" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><div class="mb-3"><label for="account-email" class="block text-sm font-semibold mb-2">Email</label><input type="email" id="account-email" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><div class="mb-3"><label for="account-phone" class="block text-sm font-semibold mb-2">Phone Number</label><input type="tel" id="account-phone" class="w-full border border-gray-300 p-2 rounded text-sm" required></div><button type="submit" class="w-full bg-blue-500 text-white py-2 font-semibold rounded hover:bg-blue-600 transition duration-300 text-sm"><i class="fas fa-save mr-2"></i>Save Changes</button></form><p id="account-changes-left" class="mt-3 text-xs text-gray-600"></p></div><!-- Receipt Modal --><div id="receipt-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden"><div class="relative top-20 mx-auto p-5 border w-80 shadow-lg rounded-md bg-white animate-fadeIn"><div class="mt-3 text-center"><h3 class="text-lg leading-6 font-medium text-gray-900">Order Receipt</h3><div class="mt-2 px-7 py-3"><div class="text-left"><p class="text-xs text-gray-500" id="receipt-content"></p></div></div><div class="items-center px-4 py-3"><button id="download-receipt" class="px-4 py-2 bg-blue-500 text-white text-sm font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300 transition duration-300"><i class="fas fa-download mr-2"></i>Download Receipt</button></div><div class="items-center px-4 py-3"><button id="close-receipt" class="px-4 py-2 bg-gray-500 text-white text-sm font-medium rounded-md w-full shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 transition duration-300"><i class="fas fa-times mr-2"></i>Close</button></div></div></div></div></div><!-- Footer --><footer class="bg-white mt-4 p-3 shadow-md rounded-lg animate-fadeIn"><div class="max-w-6xl mx-auto px-3 sm:px-4 lg:px-6"><div class="flex justify-between items-center"><p class="text-xs text-gray-600">&copy;2023 Quick Connect.All rights reserved.</p><div class="flex space-x-3"><a href="#" class="text-gray-600 hover:text-blue-600 transition duration-300"><i class="fab fa-facebook-f"></i></a><a href="#" class="text-gray-600 hover:text-blue-600 transition duration-300"><i class="fab fa-twitter"></i></a><a href="#" class="text-gray-600 hover:text-blue-600 transition duration-300"><i class="fab fa-instagram"></i></a></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script><script src="https://js.paystack.co/v1/inline.js"></script><script type="module">import{initializeApp}from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,sendPasswordResetEmail,updateProfile}from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";import{getDatabase,ref,set,push,query,orderByChild,equalTo,limitToLast,onValue,get,update}from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";const firebaseConfig={apiKey:"AIzaSyB6GlfKxT-l08no6Q3rDWYRLZB6PCnE3is",authDomain:"ckayagents.firebaseapp.com",databaseURL:"https://ckayagents-default-rtdb.firebaseio.com",projectId:"ckayagents",storageBucket:"ckayagents.firebasestorage.app",messagingSenderId:"602589349191",appId:"1:602589349191:web:cbf713b48483aeae327862"};const app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getDatabase(app);const notyf=new Notyf({duration:3000,position:{x:'right',y:'top'},types:[{type:'success',background:'#4CAF50',icon:{className:'fas fa-check-circle',tagName:'i',color:'white'}},{type:'error',background:'#F44336',icon:{className:'fas fa-exclamation-circle',tagName:'i',color:'white'}}]});const mainContent=document.getElementById('main-content');const homePage=document.getElementById('home-page');const dataPage=document.getElementById('data-page');const loginPage=document.getElementById('login-page');const signupPage=document.getElementById('signup-page');const ordersPage=document.getElementById('orders-page');const forgotPasswordPage=document.getElementById('forgot-password-page');const navLogin=document.getElementById('nav-login');const navSignup=document.getElementById('nav-signup');const navLogout=document.getElementById('nav-logout');const navOrders=document.getElementById('nav-orders');const mobileMenu=document.getElementById('mobile-menu');const menuButton=document.getElementById('menu-button');const loginForm=document.getElementById('login-form');const signupForm=document.getElementById('signup-form');const forgotPasswordForm=document.getElementById('forgot-password-form');const buyButton=document.getElementById('buy-button');const sizeOptions=document.querySelectorAll('#size-options button');const ordersList=document.getElementById('orders-list');const forgotPasswordLink=document.getElementById('forgot-password-link');const receiptModal=document.getElementById('receipt-modal');const receiptContent=document.getElementById('receipt-content');const downloadReceiptBtn=document.getElementById('download-receipt');const closeReceiptBtn=document.getElementById('close-receipt');const accountForm=document.getElementById('account-form');const accountChangesLeft=document.getElementById('account-changes-left');let currentUser=null;let selectedSize=null;let selectedPrice=null;let currentUsername='';let accountChangesCount=0;function showPage(pageId){const pages=[homePage,dataPage,loginPage,signupPage,ordersPage,forgotPasswordPage,document.getElementById('account-page')];pages.forEach(page=>page.classList.add('hidden'));document.getElementById(pageId).classList.remove('hidden');document.getElementById(pageId).classList.add('animate-fadeIn')}function updateNavigation(){const navItems=['login','signup','logout','orders','account'];navItems.forEach(item=>{const desktopItem=document.getElementById(`nav-${item}`);const mobileItem=document.getElementById(`nav-mobile-${item}`);if(currentUser){if(item==='login'||item==='signup'){desktopItem.classList.add('hidden');mobileItem.classList.add('hidden')}else{desktopItem.classList.remove('hidden');mobileItem.classList.remove('hidden')}}else{if(item==='login'||item==='signup'){desktopItem.classList.remove('hidden');mobileItem.classList.remove('hidden')}else{desktopItem.classList.add('hidden');mobileItem.classList.add('hidden')}}})}document.getElementById('nav-home').addEventListener('click',()=>showPage('home-page'));document.getElementById('nav-data').addEventListener('click',()=>showPage('data-page'));document.getElementById('nav-login').addEventListener('click',()=>showPage('login-page'));document.getElementById('nav-signup').addEventListener('click',()=>showPage('signup-page'));document.getElementById('nav-orders').addEventListener('click',()=>{if(currentUser){showPage('orders-page');loadOrders()}else{notyf.error('Please login to view orders')}});document.getElementById('nav-logout').addEventListener('click',logout);forgotPasswordLink.addEventListener('click',(e)=>{e.preventDefault();showPage('forgot-password-page')});document.getElementById('nav-mobile-home').addEventListener('click',()=>{showPage('home-page');mobileMenu.classList.add('hidden')});document.getElementById('nav-mobile-data').addEventListener('click',()=>{showPage('data-page');mobileMenu.classList.add('hidden')});document.getElementById('nav-mobile-orders').addEventListener('click',()=>{if(currentUser){showPage('orders-page');loadOrders()}else{notyf.error('Please login to view orders')}mobileMenu.classList.add('hidden')});document.getElementById('nav-mobile-login').addEventListener('click',()=>{showPage('login-page');mobileMenu.classList.add('hidden')});document.getElementById('nav-mobile-signup').addEventListener('click',()=>{showPage('signup-page');mobileMenu.classList.add('hidden')});document.getElementById('nav-mobile-logout').addEventListener('click',()=>{logout();mobileMenu.classList.add('hidden')});document.getElementById('go-to-data').addEventListener('click',()=>showPage('data-page'));menuButton.addEventListener('click',()=>{mobileMenu.classList.toggle('hidden')});async function login(email,password){try{const userCredential=await signInWithEmailAndPassword(auth,email,password);currentUser=userCredential.user;const userRef=ref(db,'users/'+currentUser.uid);const snapshot=await get(userRef);if(snapshot.exists()){currentUsername=snapshot.val().username;accountChangesCount=snapshot.val().accountChangesCount||0}else{currentUsername=currentUser.displayName||'N/A';accountChangesCount=0}notyf.success('Logged in successfully');updateNavigation();showPage('home-page')}catch(error){notyf.error(error.message)}}async function signup(username,phone,email,password){try{const userCredential=await createUserWithEmailAndPassword(auth,email,password);currentUser=userCredential.user;await updateProfile(currentUser,{displayName:username});await set(ref(db,'users/'+currentUser.uid),{username:username,phone:phone,email:email,accountChangesCount:0});currentUsername=username;accountChangesCount=0;notyf.success('Account created successfully');updateNavigation();showPage('home-page')}catch(error){notyf.error(error.message)}}async function logout(){try{await signOut(auth);currentUser=null;currentUsername='';accountChangesCount=0;notyf.success('Logged out successfully');updateNavigation();showPage('home-page')}catch(error){notyf.error(error.message)}}async function resetPassword(email){try{await sendPasswordResetEmail(auth,email);notyf.success('Password reset email sent. Check your inbox.');showPage('login-page')}catch(error){notyf.error(error.message)}}loginForm.addEventListener('submit',(e)=>{e.preventDefault();const email=document.getElementById('login-email').value;const password=document.getElementById('login-password').value;login(email,password)});signupForm.addEventListener('submit',(e)=>{e.preventDefault();const username=document.getElementById('signup-username').value;const phone=document.getElementById('signup-phone').value;const email=document.getElementById('signup-email').value;const password=document.getElementById('signup-password').value;const confirmPassword=document.getElementById('signup-confirm-password').value;if(password!==confirmPassword){notyf.error('Passwords do not match');return}signup(username,phone,email,password)});forgotPasswordForm.addEventListener('submit',(e)=>{e.preventDefault();const email=document.getElementById('forgot-password-email').value;resetPassword(email)});sizeOptions.forEach(button=>{button.addEventListener('click',()=>{sizeOptions.forEach(btn=>btn.classList.remove('bg-blue-500','text-white'));button.classList.add('bg-blue-500','text-white');selectedSize=button.getAttribute('data-size');selectedPrice=button.getAttribute('data-price');document.getElementById('price').textContent=selectedPrice})});function calculateTax(price){const numericPrice=parseFloat(price.replace('₵',''));let taxRate;if(numericPrice<=10){taxRate=0.05}else if(numericPrice<=50){taxRate=0.07}else{taxRate=0.10}const tax=numericPrice*taxRate;const total=numericPrice+tax;return{tax:tax.toFixed(2),total:total.toFixed(2)}}buyButton.addEventListener('click',async()=>{if(!currentUser){notyf.error('Please login to make a purchase');return}const phoneNumber=document.getElementById('phone-number').value;if(!selectedSize){notyf.error('Please select a data size.');return}if(!phoneNumber){notyf.error('Please enter a phone number.');return}const{tax,total}=calculateTax(selectedPrice);const reference='TXN-'+Date.now()+'-'+Math.random().toString(36).substring(2,15);try{const handler=PaystackPop.setup({key:'pk_live_0e70d8a9612b98c92761e3478abc47f900338df2',email:currentUser.email,amount:parseFloat(total)*100,currency:'GHS',ref:reference,callback:function(response){handlePaystackResponse(response,phoneNumber,selectedSize,selectedPrice,tax,total)},onClose:function(){notyf.error('Transaction was not completed, window closed.')}});handler.openIframe()}catch(error){notyf.error('An error occurred. Please try again.');console.error('Error:',error)}});async function handlePaystackResponse(response,phoneNumber,size,price,tax,total){try{const paymentVerified=await verifyPaystackPayment(response.reference);if(paymentVerified){await processVerifiedOrder(response.reference,phoneNumber,size,price,tax,total)}else{notyf.error('Payment could not be verified. Please contact support.')}}catch(error){notyf.error('An error occurred during payment processing. Please contact support.');console.error('Error:',error)}}async function verifyPaystackPayment(reference){try{const response=await fetch('https://your-backend-url.com/verify-paystack-payment',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify({reference})});const data=await response.json();return data.status==='success'}catch(error){console.error('Error verifying Paystack payment:',error);return!1}}async function processVerifiedOrder(reference,phoneNumber,size,price,tax,total){try{const hubnetResponse=await submitOrderToHubnet(phoneNumber,size,reference);if(hubnetResponse.status){await processBundle(phoneNumber,size);await saveOrder(phoneNumber,size,price,tax,total,reference);showReceipt(phoneNumber,size,price,tax,total,reference);notyf.success('Payment successful and order processed. Transaction ref is '+reference);clearForm()}else{notyf.error('Order submission to Hubnet failed. Please contact support.')}}catch(error){notyf.error('An error occurred during order processing. Please contact support.');console.error('Error:',error)}}async function submitOrderToHubnet(phoneNumber,size,reference){try{const response=await fetch('https://console.hubnet.app/live/api/context/business/transaction/mtn-new-transaction',{method:'POST',headers:{'Content-Type':'application/json','token':'Bearer v61fayeo5LeSlVy1AgjHqgXFrYAgogDr2E7'},body:JSON.stringify({phone:phoneNumber,volume:size,reference:reference,referrer:currentUser.phoneNumber||'',webhook:'https://your-webhook-url.com/callback'})});return await response.json()}catch(error){console.error('Error submitting order to Hubnet:',error);throw error}}async function saveOrder(phoneNumber,size,price,tax,total,reference){try{const newOrderRef=push(ref(db,'orders'));await set(newOrderRef,{userId:currentUser.uid,username:currentUsername,phoneNumber:phoneNumber,size:size,price:price,tax:tax,total:total,reference:reference,timestamp:Date.now(),status:'pending'});notyf.success('Order saved successfully')}catch(error){notyf.error('Error saving order: '+error.message)}}async function processBundle(phoneNumber,size){try{const response=await fetch('https://your-backend-url.com/process-bundle',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify({phoneNumber,size})});const data=await response.json();if(data.status==='success'){notyf.success('Bundle processed successfully')}else{notyf.error('Failed to process bundle. Please contact support.')}}catch(error){notyf.error('An error occurred while processing the bundle. Please contact support.');console.error('Error:',error)}}async function loadOrders(){if(!currentUser)return;try{const ordersRef=ref(db,'orders');const userOrdersQuery=query(ordersRef,orderByChild('userId'),equalTo(currentUser.uid),limitToLast(10));onValue(userOrdersQuery,(snapshot)=>{ordersList.innerHTML='';if(snapshot.exists()){const orders=[];snapshot.forEach((childSnapshot)=>{orders.push({id:childSnapshot.key,...childSnapshot.val()})});orders.sort((a,b)=>b.timestamp-a.timestamp);orders.forEach((order)=>{const orderElement=document.createElement('div');orderElement.className='bg-gray-100 p-3 rounded mb-3 animate-slideIn text-xs';orderElement.innerHTML=` <p><strong>Username:</strong>${order.username || 'N/A'}</p><p><strong>Size:</strong>${order.size}</p><p><strong>Price:</strong>${order.price}</p><p><strong>Tax:</strong>₵${order.tax}</p><p><strong>Total:</strong>₵${order.total}</p><p><strong>Phone:</strong>${order.phoneNumber}</p><p><strong>Reference:</strong>${order.reference}</p><p><strong>Date:</strong>${new Date(order.timestamp).toLocaleString()}</p><p><strong>Status:</strong><span class="status-${order.status}">${order.status}</span></p>`;ordersList.appendChild(orderElement)})}else{ordersList.innerHTML='<p class="text-sm">No orders found.</p>'}},{onlyOnce:!0})}catch(error){notyf.error('Error loading orders: '+error.message)}}function showReceipt(phoneNumber,size,price,tax,total,reference){const receiptHTML=` <div class="text-left text-xs"><p><strong>Username:</strong>${currentUsername || 'N/A'}</p><p><strong>Size:</strong>${size}</p><p><strong>Price:</strong>${price}</p><p><strong>Tax:</strong>₵${tax}</p><p><strong>Total:</strong>₵${total}</p><p><strong>Phone:</strong>${phoneNumber}</p><p><strong>Reference:</strong>${reference}</p><p><strong>Date:</strong>${new Date().toLocaleString()}</p><p><strong>Status:</strong>Completed</p></div>`;receiptContent.innerHTML=receiptHTML;receiptModal.classList.remove('hidden')}downloadReceiptBtn.addEventListener('click',()=>{const receiptText=receiptContent.innerText;const blob=new Blob([receiptText],{type:'text/plain'});const url=URL.createObjecturl(blob);const a=document.createElement('a');a.href=url;a.download='receipt.txt';document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjecturl(url)});closeReceiptBtn.addEventListener('click',()=>{receiptModal.classList.add('hidden')});document.getElementById('nav-account').addEventListener('click',()=>showPage('account-page'));document.getElementById('nav-mobile-account').addEventListener('click',()=>{showPage('account-page');mobileMenu.classList.add('hidden')});const accountUsername=document.getElementById('account-username');const accountEmail=document.getElementById('account-email');const accountPhone=document.getElementById('account-phone');function loadAccountDetails(){if(currentUser){const userRef=ref(db,'users/'+currentUser.uid);onValue(userRef,(snapshot)=>{const userData=snapshot.val();if(userData){accountUsername.value=userData.username||'';accountEmail.value=userData.email||'';accountPhone.value=userData.phone||'';accountChangesCount=userData.accountChangesCount||0;updateAccountChangesLeft()}},{onlyOnce:!0})}}function updateAccountChangesLeft(){const changesLeft=2-accountChangesCount;accountChangesLeft.textContent=`Changes left:${changesLeft}`;if(changesLeft===0){accountForm.querySelector('button[type="submit"]').disabled=!0}}accountForm.addEventListener('submit',async(e)=>{e.preventDefault();if(currentUser&&accountChangesCount<2){try{await update(ref(db,'users/'+currentUser.uid),{username:accountUsername.value,email:accountEmail.value,phone:accountPhone.value,accountChangesCount:accountChangesCount+1});await updateProfile(currentUser,{displayName:accountUsername.value});currentUsername=accountUsername.value;accountChangesCount++;updateAccountChangesLeft();notyf.success('Account details updated successfully')}catch(error){notyf.error('Error updating account details: '+error.message)}}else{notyf.error('You have reached the maximum number of account changes.')}});function clearForm(){document.getElementById('phone-number').value='';sizeOptions.forEach(btn=>btn.classList.remove('bg-blue-500','text-white'));selectedSize=null;selectedPrice=null;document.getElementById('price').textContent='₵5.50'}auth.onAuthStateChanged((user)=>{currentUser=user;if(user){const userRef=ref(db,'users/'+user.uid);get(userRef).then((snapshot)=>{if(snapshot.exists()){currentUsername=snapshot.val().username;accountChangesCount=snapshot.val().accountChangesCount||0}else{currentUsername=user.displayName||'N/A';accountChangesCount=0}loadAccountDetails();updateAccountChangesLeft()})}else{currentUsername='';accountChangesCount=0}updateNavigation();showPage('home-page')});</script></body></html>
